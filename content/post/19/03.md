---
title: "03ï½œTDDæ¼”ç¤ºï¼ˆ3ï¼‰ï¼šæŒ‰æµ‹è¯•ç­–ç•¥é‡ç»„æµ‹è¯•"
date: 2022-03-23T00:00:02+08:00
draft: false
tags: ["TDD","æå®¢æ—¶é—´"]
categories: ["å­¦ä¹ ç¬”è®°"]
---

> [TDD å­¦ä¹ ç¬”è®° | æå®¢æ—¶é—´ | å¾æ˜ŠÂ·TDD é¡¹ç›®å®æˆ˜ 70 è®²](../dir)

[ğŸ† è¯¾ç¨‹åŸæ–‡é“¾æ¥](http://gk.link/a/11gHt) [ğŸ¿ æºç åœ°å€](https://github.com/wyyl1/geektime-tdd/tree/branch-03)

## æµ‹è¯•ä»£ç éœ€è¦é‡æ„

- é‡æ„ç”Ÿäº§ä»£ç çš„æ—¶å€™ä¸è¦æ”¹æµ‹è¯•ä»£ç 
- é‡æ„æµ‹è¯•ä»£ç çš„æ—¶å€™ä¸è¦æ”¹ç”Ÿäº§ä»£ç 

### éšç€åŠŸèƒ½è¿­ä»£ï¼Œæµ‹è¯•ä»£ç ä¹Ÿä¼šå†—ä½™ï¼Œéœ€è¦åŠæ—¶é‡æ„ï¼Œæ¶ˆé™¤å†—ä½™ä»£ç 

### å®é™…å¼€å‘è¿‡ç¨‹ï¼š

- æŒ‰åŠŸèƒ½å†™å‡ºå‡ºä»»åŠ¡åˆ—è¡¨
- å…ˆæŒ‰ç…§ä»»åŠ¡åˆ—è¡¨å®Œæˆäº†ä¸€å—åŠŸèƒ½ç‚¹
- å‘ç°äº†åå‘³é“ï¼Œå¼€å§‹é‡æ„
- é€šè¿‡é‡æ„å¼•å…¥äº†æ–°çš„ç»„ä»¶ï¼Œæ”¹å˜äº†æ¶æ„
- äºæ˜¯å‰©ä½™çš„ä»»åŠ¡åˆ—è¡¨éšä¹‹æ”¹å˜
- é™†ç»­å®Œæˆè¿™äº›ä»»åŠ¡ï¼Œå‘ç°ä¸ä¸€è‡´çš„æµ‹è¯•ç­–ç•¥ï¼Œé‡ç»„æµ‹è¯•

## ä»»åŠ¡åˆ—è¡¨

- æ˜¯éšä»£ç ç»“æ„ï¼ˆé‡æ„ï¼‰ã€æµ‹è¯•ç­–ç•¥ï¼ˆåœ¨å“ªä¸ªèŒƒå›´å†…æµ‹è¯•ï¼‰ã€ä»£ç å®ç°æƒ…å†µï¼ˆå­˜åœ¨å“ªäº›ç¼ºé™·ï¼‰ç­‰å› ç´ è€ŒåŠ¨æ€è°ƒæ•´çš„åˆ—è¡¨
- **å®ƒçš„å†…å®¹ä½“ç°äº†æˆ‘ä»¬æœ€æ–°çš„è®¤çŸ¥**
- **å®ƒçš„å˜åŒ–è®°å½•äº†æˆ‘ä»¬è®¤çŸ¥æ”¹å˜çš„è¿‡ç¨‹**

## æå‰å°† Option å¯¹è±¡æå–å‡º flag çš„ä»£ç åœ¨ **bad path** ç¿»è½¦äº†

- å› ä¸ºè·å–ä¸åˆ°åŸå§‹è¾“å…¥å‚æ•°ï¼Œæ— æ³•ç»™å‡ºå‹å¥½æç¤º

> **è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æº**
> â€”â€” å…‹åŠªç‰¹ä¼˜åŒ–åŸåˆ™ï¼ŒæºäºDonald Knuthçš„ä¹¦ã€Šè®¡ç®—æœºç¼–ç¨‹è‰ºæœ¯ã€‹ï¼ˆæœ€æ—©ç”±Tony Hoareæå‡ºï¼‰

BooleanOptionParser.java

```java
// å¾æ˜Šè€å¸ˆçš„ä»£ç 
public Object parse(List<String> arguments, Option option) {
    int index = arguments.indexOf(flag);
    if (!arguments.get(index + 1).startsWith("-")) {
        throw new TooManyArgumentsException(option.value);
    }
    return index != -1;
}

// æˆ‘çš„ä»£ç 
public Object parse(List<String> arguments, String flag) {
    int index = arguments.indexOf(flag);
    if (!arguments.get(index + 1).startsWith("-")) {
        throw new TooManyArgumentsException("æ‹¿ä¸åˆ°åŸå§‹è¾“å…¥å‚æ•°â—ï¸ğŸ™€ğŸ™€ğŸ™€");
    }
    return index != -1;
}
```

## è§†é¢‘ä¸­ä»£ç çš„åå‘³é“

### if æ²¡æœ‰ "{}"

BooleanOptionParser.java

```java
public Object parse(List<String> arguments, Option option) {
    int index = arguments.indexOf("-" + option.value());
    if (!arguments.get(index + 1).startsWith("-")) throw new TooManyArgumentsException(option.value());
    return index != -1;
}
```

- è‘—åæ¡ˆä¾‹ï¼šè‹¹æœå…¬å¸çš„â€œGoTo Fail æ¼æ´â€ï¼Œå°±æ˜¯å› ä¸ºæ²¡æœ‰æ‹¬å·å¼•èµ·çš„ã€‚
- å†…å®¹æ‘˜è‡ªï¼š[æå®¢æ—¶é—´ | ä»£ç ç²¾è¿›ä¹‹è·¯ | 02 | æŠŠé”™è¯¯å…³åœ¨ç¬¼å­é‡Œçš„äº”é“å…³å¡](http://gk.link/a/11gIn)
  - ä½œè€…ç®€ä»‹ï¼šèŒƒå­¦é›· å‰ Oracle é¦–å¸­è½¯ä»¶å·¥ç¨‹å¸ˆï¼ŒJava SE å®‰å…¨ç»„æˆå‘˜ï¼ŒOpenJDK è¯„å®¡æˆå‘˜

C è¯­è¨€ä¼ªä»£ç 

```cpp
    if ((error = doSomething()) != 0)
        goto fail;         
        goto fail;    
    if ((error= doMore()) != 0)        
        goto fail;
fail:    
    return error;
```

### åç­å¼‚å¸¸ä¿¡æ¯ï¼Œæ— æ³•è¿½æº¯é”™è¯¯åŸå› ï¼Œå¯¼è‡´æ’é”™å›°éš¾

Args.java

```java
public static <T> T parse(Class<T> optionsClass, String... args) {
    Constructor<?> constructor = optionsClass.getDeclaredConstructors()[0];
    try {
        List<String> arguments = Arrays.stream(args).toList();
        Object[] values = Arrays.stream(constructor.getParameters())
                .map(it -> parseOption(arguments, it))
                .toArray();

        return (T) constructor.newInstance(values);
    } catch (Exception e) {
        // æ­¤å¤„è§†é¢‘ä¸­æ²¡æœ‰æ‰“å°å¼‚å¸¸ä¿¡æ¯ï¼ˆåç­äº†å¼‚å¸¸ï¼Œæ— æ³•è¿½æº¯é”™è¯¯åŸå› ï¼‰
        // ç¬¬ä¸€æ¬¡é‡åˆ°æ•°ç»„è¶Šç•Œçš„é—®é¢˜æ—¶ï¼Œå¦‚æœä¸å¬è§†é¢‘ä¸­çš„ä»‹ç»
        // ä»é”™è¯¯æ—¥å¿—ä¸­åªèƒ½çœ‹åˆ°æµ‹è¯•ç»“æœä¸åŒ¹é…çš„å¤±è´¥ä¿¡æ¯ï¼Œæ— æ³•å®šä½é”™è¯¯åŸå› 
        e.printStackTrace();
        throw new RuntimeException();
    }
}
```
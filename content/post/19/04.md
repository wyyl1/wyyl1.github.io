---
title: "04ï½œTDDæ¼”ç¤ºï¼ˆ4ï¼‰ï¼šå®ç°å¯¹äºåˆ—è¡¨å‚æ•°çš„æ”¯æŒ"
date: 2022-03-26T00:00:02+08:00
draft: false
tags: ["TDD","æå®¢æ—¶é—´"]
categories: ["å­¦ä¹ ç¬”è®°"]
---

> [TDD å­¦ä¹ ç¬”è®° | æå®¢æ—¶é—´ | å¾æ˜ŠÂ·TDD é¡¹ç›®å®æˆ˜ 70 è®²](../dir)

[ğŸ† è¯¾ç¨‹åŸæ–‡é“¾æ¥](http://gk.link/a/11hjF) [ğŸ¿ æºç åœ°å€](https://github.com/wyyl1/geektime-tdd/tree/branch-04) âš ï¸ ä»£ç å·²ç¿»è½¦

æ„Ÿå—åˆ°äº†æé™ç¼–ç¨‹çš„æ°”æ¯ï¼ğŸ˜ƒ

## ä½¿ç”¨æœ‰æ„ä¹‰çš„æ–¹æ³•åä»£æ›¿æ³¨é‡Š

- || ä¸åŒçš„æ¡ä»¶æŠ½å–åˆ°ä¸åŒçš„æ–¹æ³•
- && æ¡ä»¶é€šå¸¸æŠ½å–åˆ°åŒä¸€ä¸ªæ–¹æ³•é‡Œ

SingleValueOptionParser.java

```java
public T parse(List<String> arguments, Option option) {
    String flag = "-" + option.value();
    int index = arguments.indexOf(flag);
    if (index == -1) {
        return defaultValue;
    }
    if (isReachEndOfList(arguments, index) ||
            isFollowedByOtherFlag(arguments, index)) {
        throw new InsufficientArgumentsException(option.value());
    }
    if (secondArgumentIsNotAFlag(arguments, index)) {
        throw new TooManyArgumentsException(option.value());
    }
    return valueParser.apply(arguments.get(index + 1));
}
```

âš ï¸ å³ä½¿ç”¨äº†æœ‰æ„ä¹‰çš„æ–¹æ³•ä¾ç„¶æš´éœ²äº†å¤ªå¤šå®ç°ç»†èŠ‚

âœ… é‡æ„åå˜ç›´è§‚

```java
public T parse(List<String> arguments, Option option) {
    String flag = "-" + option.value();
    int index = arguments.indexOf(flag);
    if (index == -1) {
        return defaultValue;
    }

    List<String> values = values(arguments, index);

    if (values.size() < 1) {
        throw new InsufficientArgumentsException(option.value());
    }
    if (values.size() > 1) {
        throw new TooManyArgumentsException(option.value());
    }
    return valueParser.apply(arguments.get(index + 1));
}
```

SingleValueOptionParser.java values æ–¹æ³•

å¾æ˜Šè€å¸ˆçš„

```java
private List<String> values(List<String> arguments, int index) {
    return arguments.subList(index + 1, IntStream.range(index + 1, arguments.size())
            .filter(it -> arguments.get(it).startsWith("-"))
            .findFirst().orElse(arguments.size()));
}
```

æˆ‘çš„

```java
private List<String> values(List<String> arguments, int index) {
    int followingFlag = IntStream.range(index + 1, arguments.size())
            .filter(it -> arguments.get(it).startsWith("-"))
            .findFirst().orElse(arguments.size());

    return arguments.subList(index + 1, followingFlag);
}
```

è™½ç„¶æˆ‘çš„ä»£ç é•¿ç‚¹ï¼Œä½†æ„Ÿè§‰æ›´æ˜“è¯»

- å› ä¸º followingFlag æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£é‡Š
- ä¸ç„¶è¦é˜…è¯»æ•´æ®µä»£ç æ‰èƒ½ç†è§£
- ğŸ˜… è™½ç„¶ä¸¤æ®µä»£ç æˆ‘éƒ½ä¸æ˜¯å¾ˆæ‡‚ï¼Œä½†ä¸å½±å“å­¦ä¹ è®¨è®º

ç»è¿‡è€å¸ˆæŒ‡ç‚¹

> - å¯ä»¥ ç›¸å½“äºæŠ½å˜é‡åŠ æ³¨é‡Š
> - å½“ç„¶ä»å¯è¯»æ€§æ¥è¯´ æŠ½æ–¹æ³•æ›´å¥½è¯»
> - javaæ²¡æœ‰å†…åµŒæ–¹æ³• ä¸ç„¶å¯ä»¥ä¸ç”¨è„±ç¦»å½“å‰ä¸Šä¸‹æ–‡ï¼ˆğŸ™€ è¿™ç‚¹å·²ç»è¶…å‡ºäº†æˆ‘ç›®å‰çš„çŸ¥è¯†èŒƒå›´ï¼Œå…ˆè®°å½•ä¸‹æ¥ï¼‰

æˆ‘æŠ½å‡ºäº†ä¸€ä¸ªæ–¹æ³•ï¼Œç¡®å®æ›´å¥½äº† ğŸ¥²

```java
private List<String> values(List<String> arguments, int index) {
    int followingFlag = getFollowingFlag(arguments, index);
    return arguments.subList(index + 1, followingFlag);
}
```

è€å¸ˆåˆè¯´äº†

> - è¿™æ—¶å€™ä½ inlineå›å»ä¹Ÿä¸å½±å“é˜…è¯»
> - åè€Œæ›´å¥½è¯»

äºæ˜¯ä»£ç åˆå›åˆ°äº†å¼€å§‹

---
title: "02ï½œTDDæ¼”ç¤ºï¼ˆ2ï¼‰ï¼šè¯†åˆ«åå‘³é“ä¸ä»£ç é‡æ„"
date: 2022-03-20T00:00:02+08:00
draft: false
tags: ["TDD","æå®¢æ—¶é—´"]
categories: ["å­¦ä¹ ç¬”è®°"]
---

> [TDD å­¦ä¹ ç¬”è®° | æå®¢æ—¶é—´ | å¾æ˜ŠÂ·TDD é¡¹ç›®å®æˆ˜ 70 è®²](../dir)

[ğŸ† è¯¾ç¨‹åŸæ–‡é“¾æ¥](http://gk.link/a/11glh) [ğŸ¿ æºç åœ°å€](https://github.com/wyyl1/geektime-tdd/tree/branch-02)

## æ˜¯å¦è¿›å…¥é‡æ„æœ‰ä¸¤ä¸ªå…ˆå†³æ¡ä»¶

1. æµ‹è¯•éƒ½æ˜¯ç»¿çš„
2. åå‘³é“è¶³å¤Ÿæ˜æ˜¾

## TDD çš„çº¢ / ç»¿ / é‡æ„å¾ªç¯ï¼Œåˆ†ç¦»äº†å…³æ³¨ç‚¹

- åœ¨çº¢ / ç»¿é˜¶æ®µï¼Œæˆ‘ä»¬ä¸å…³å¿ƒä»£ç ç»“æ„ï¼Œåªå…³æ³¨åŠŸèƒ½çš„ç´¯ç§¯
- è€Œåœ¨é‡æ„çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºæµ‹è¯•çš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ—¶åˆ»æ£€æŸ¥åŠŸèƒ½æ˜¯å¦ä¾æ—§æ­£ç¡®ï¼ŒåŒæ—¶å°†å…³æ³¨ç‚¹è½¬ç§»åˆ°â€œæ€ä¹ˆè®©ä»£ç å˜å¾—æ›´å¥½â€ä¸Šå»

## IDEA Refactorï¼ˆé‡æ„ï¼‰å¿«æ·é”®ï¼ˆMac ç³»ç»Ÿï¼‰

- Extract Method **âŒ¥âŒ˜M**
- Inline **âŒ¥âŒ˜N** ï¼ˆä¸¤ç§æƒ…å†µï¼‰
  - é€‰ä¸­å½“å‰è¡Œ
  - é€‰ä¸­ä¸€ä¸ªè°ƒç”¨æ–¹æ³•
- é€‰ä¸­æ¥å£çš„å®ç°ç±»ï¼šUse Interface Where Possible ï¼ˆå°½å¯èƒ½ä½¿ç”¨æ¥å£ï¼‰

## ä¼˜åŒ–æ€è·¯

- ä¸åŒçš„å®ç°æå–å‡ºæ¥å£
- å®ç°æ¥å£
- if else åˆ†æ”¯ä½¿ç”¨æ¥å£æ›¿æ¢
- æ„é€ å‡½æ•°è½¬å·¥å‚æ–¹æ³•ï¼ˆå› ä¸ºå·¥å‚æ–¹æ³•å¯ä»¥ inLineï¼Œæ„é€ å‡½æ•°ä¸è¡Œï¼‰
- å°½å¯èƒ½ä½¿ç”¨æ¥å£
- inLine
  - ç²¾ç®€ä»£ç ï¼ˆä¸ç”¨è·³è½¬åˆ°æ–¹æ³•çœ‹å…·ä½“å®ç°ï¼‰
  - æ¶ˆé™¤å¤šä½™ä»£ç 

## ä»£ç å’Œè€å¸ˆä¸ä¸€æ ·çš„åœ°æ–¹

- åŒºåˆ«ï¼šæå‰æŠ½å–äº†å…¬å…±å˜é‡ String flag = "-" + option.value();
- ç†ç”±ï¼š
  - DRY åŸåˆ™
  - æ­¤æ—¶å¾æ˜Šè€å¸ˆçš„ä»£ç é‡Œæœ‰å¤šå¤„é‡å¤
- æ„Ÿè§‰å‡ºç°é—®é¢˜ï¼š
  - æˆ‘çš„å‘½åæ¯”è¾ƒç³Ÿç³•ï¼šSingleValueOptionParser ç±»ä¸­ parse(List<String> arguments, String flag)ï¼Œå‚æ•°å’Œ Option æ— å…³
  - å› ä¸ºå°† Option è½¬æ¢æˆäº† Stringï¼Œåç»­å¤šå‚æ•°è§£æï¼Œå¯èƒ½ä¼šå‡ºé—®é¢˜

### ç¬¬ä¸€ç‰ˆ

Args.java

```java
public class Args {
    private static Object parseOption(List<String> arguments, Parameter parameter) {
        Option option = parameter.getAnnotation(Option.class);
        Object value = null;

        // æå‰æŠ½å–äº†å…¬å…±å˜é‡ï¼Œå¯¼è‡´ä»£ç å’Œå¾æ˜Šè€å¸ˆçš„ä¸ä¸€æ ·
        String flag = "-" + option.value();
        if (parameter.getType() == boolean.class) {
            value = arguments.contains(flag);
        }
        if (parameter.getType() == int.class) {
            int index = arguments.indexOf(flag);
            value = Integer.parseInt(arguments.get(index + 1));
        }
        if (parameter.getType() == String.class) {
            int index = arguments.indexOf(flag);
            value = arguments.get(index + 1);
        }
        return value;
    }
}
```

### ç¬¬äºŒç‰ˆ

Args.java

```java
public class Args {

    // å¾æ˜Šè€å¸ˆçš„
    private static Object parseOption(List<String> arguments, Parameter parameter) {
        return PARSERS.get(parameter.getType()).parse(arguments, parameter.getAnnotation(Option.class));
    }

    // æˆ‘çš„
    private static Object parseOption(List<String> arguments, Parameter parameter) {
        return PARSERS.get(parameter.getType()).parse(arguments, "-" + parameter.getAnnotation(Option.class).value());
    }
}
```

```java
class SingleValueOptionParser<T> implements OptionParser {

    // å¾æ˜Šè€å¸ˆçš„
    @Override
    public T parse(List<String> arguments, Option option) {
        int index = arguments.indexOf("-" + option.value());
        String value = arguments.get(index + 1);
        return valueParser.apply(value);
    }

    // æˆ‘çš„
    @Override
    public T parse(List<String> arguments, String flag) {
        int index = arguments.indexOf(flag);
        String value = arguments.get(index + 1);
        return valueParser.apply(value);
    }
}
```
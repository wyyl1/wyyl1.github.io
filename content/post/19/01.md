---
title: "01ï½œTDDæ¼”ç¤ºï¼ˆ1ï¼‰ï¼šä»»åŠ¡åˆ†è§£æ³•ä¸æ•´ä½“å·¥ä½œæµç¨‹"
date: 2022-03-20T00:00:01+08:00
draft: false
tags: ["TDD"]
categories: ["å­¦ä¹ ç¬”è®°"]
---

> [TDD å­¦ä¹ ç¬”è®° | æå®¢æ—¶é—´ | å¾æ˜ŠÂ·TDD é¡¹ç›®å®æˆ˜ 70 è®²](../dir)

[ğŸ† è¯¾ç¨‹åŸæ–‡é“¾æ¥](http://gk.link/a/11giM) [ğŸ¿ æºç åœ°å€](https://github.com/wyyl1/geektime-tdd)

## TDD æ¨¡æ¿

1. API æ„æ€ä¸ç»„ä»¶åˆ’åˆ†
   é¦–å…ˆæˆ‘ä»¬éœ€è¦è€ƒè™‘ï¼Œ**åˆ«äººå°†ä»¥ä½•ç§æ–¹å¼ä½¿ç”¨è¿™æ®µä»£ç **ï¼Œä¹Ÿå°±æ˜¯è¿™æ®µä»£ç çš„æ•´ä½“å¯¹å¤–æ¥å£éƒ¨åˆ†ã€‚
   æˆ‘ä»¬å¯ä»¥é€šè¿‡å†™æµ‹è¯•çš„æ–¹å¼ï¼Œæ¥æ„Ÿå— API çš„å‹å¥½ç¨‹åº¦
2. åœ¨ç¡®å®šäº† API çš„å½¢å¼ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å¤§è‡´æ„æ€å¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½
3. åŠŸèƒ½åˆ†è§£ä¸ä»»åŠ¡åˆ—è¡¨ â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸ï¼ˆTDD æ ¸å¿ƒä¹‹ä¸€ï¼‰
   åœ¨ API ä¸å®ç°æ–¹å¼æœ‰äº†æ–¹å‘ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®éœ€æ±‚çš„æè¿°å¯¹åŠŸèƒ½è¿›è¡Œåˆ†è§£äº†ã€‚
   è¿™é‡Œå¯ä»¥å…ˆä¸æ±‚å…¨é¢ï¼Œæœ‰ä¸ªå¤§è‡´çš„èŒƒå›´å³å¯
4. çº¢ / ç»¿å¾ªç¯
   é‚£ä¹ˆå…ˆè®©æˆ‘ä»¬é€‰æ‹©æœ€ç®€å•çš„ä»»åŠ¡ï¼Œå¹¶é€šè¿‡çº¢ç»¿å¾ªç¯å®ç°å®ƒ

## å‘½ä»¤è¡Œå‚æ•°è§£æ

ä¹ é¢˜æºè‡ª Robert C. Martin çš„ ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹ ç¬¬åå››ç« çš„ä¸€ä¸ªä¾‹å­ã€‚éœ€æ±‚æè¿°å¦‚ä¸‹ï¼š

> æˆ‘ä»¬ä¸­çš„å¤§å¤šæ•°äººéƒ½ä¸å¾—ä¸æ—¶ä¸æ—¶åœ°è§£æä¸€ä¸‹å‘½ä»¤è¡Œå‚æ•°ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰ä¸€ä¸ªæ–¹ä¾¿çš„å·¥å…·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç®€å•åœ°å¤„ç†ä¸€ä¸‹ä¼ å…¥ main å‡½æ•°çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚æœ‰å¾ˆå¤šå¼€æºå·¥å…·å¯ä»¥å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œä½†å®ƒä»¬å¯èƒ½å¹¶ä¸èƒ½å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚æ‰€ä»¥æˆ‘ä»¬å†å†™ä¸€ä¸ªå§ã€‚
> 
> ä¼ é€’ç»™ç¨‹åºçš„å‚æ•°ç”±æ ‡å¿—å’Œå€¼ç»„æˆã€‚æ ‡å¿—åº”è¯¥æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œå‰é¢æœ‰ä¸€ä¸ªå‡å·ã€‚æ¯ä¸ªæ ‡å¿—éƒ½åº”è¯¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ªä¸ä¹‹ç›¸å…³çš„å€¼ã€‚ä¾‹å¦‚ï¼š
> 
> -l -p 8080 -d /usr/logs
> 
> â€œlâ€ï¼ˆæ—¥å¿—ï¼‰æ²¡æœ‰ç›¸å…³çš„å€¼ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¸ƒå°”æ ‡å¿—ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¸º trueï¼Œä¸å­˜åœ¨åˆ™ä¸º falseã€‚â€œpâ€ï¼ˆç«¯å£ï¼‰æœ‰ä¸€ä¸ªæ•´æ•°å€¼ï¼Œâ€œdâ€ï¼ˆç›®å½•ï¼‰æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ã€‚æ ‡å¿—åé¢å¦‚æœå­˜åœ¨å¤šä¸ªå€¼ï¼Œåˆ™è¯¥æ ‡å¿—è¡¨ç¤ºä¸€ä¸ªåˆ—è¡¨ï¼š
> 
> -g this is a list -d 1 2 -3 5
> 
> "g"è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨[â€œthisâ€, â€œisâ€, â€œaâ€, â€œlistâ€]ï¼Œâ€œd"æ ‡å¿—è¡¨ç¤ºä¸€ä¸ªæ•´æ•°åˆ—è¡¨[1, 2, -3, 5]ã€‚
> 
> å¦‚æœå‚æ•°ä¸­æ²¡æœ‰æŒ‡å®šæŸä¸ªæ ‡å¿—ï¼Œé‚£ä¹ˆè§£æå™¨åº”è¯¥æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œfalse ä»£è¡¨å¸ƒå°”å€¼ï¼Œ0 ä»£è¡¨æ•°å­—ï¼Œâ€"ä»£è¡¨å­—ç¬¦ä¸²ï¼Œ[]ä»£è¡¨åˆ—è¡¨ã€‚å¦‚æœç»™å‡ºçš„å‚æ•°ä¸æ¨¡å¼ä¸åŒ¹é…ï¼Œé‡è¦çš„æ˜¯ç»™å‡ºä¸€ä¸ªå¥½çš„é”™è¯¯ä¿¡æ¯ï¼Œå‡†ç¡®åœ°è§£é‡Šä»€ä¹ˆæ˜¯é”™è¯¯çš„ã€‚
> 
> ç¡®ä¿ä½ çš„ä»£ç æ˜¯å¯æ‰©å±•çš„ï¼Œå³å¦‚ä½•å¢åŠ æ–°çš„æ•°å€¼ç±»å‹æ˜¯ç›´æ¥å’Œæ˜æ˜¾çš„ã€‚

## åŠŸèƒ½åˆ†æ

### ç®€ä»‹

è§£æç©ºæ ¼åˆ†å‰²çš„å­—ç¬¦ä¸²

### ç¤ºä¾‹

```cmd
-l -p 8080 -d /usr/logs -g this is a list -d 1 2 -3 5
```

### åŠŸèƒ½

- å‡å·åçš„å­—ç¬¦ä»£è¡¨ä¸€ä¸ªåŠŸèƒ½ç¬¦å·
- l
  - åŠŸèƒ½ï¼šæ—¥å¿—ï¼Œæ²¡æœ‰ç›¸å…³çš„å€¼
  - ç±»å‹ï¼šå¸ƒå°”
  - æè¿°ï¼šå­˜åœ¨=trueï¼›ä¸å­˜åœ¨=false
- p
  - åŠŸèƒ½ï¼šç«¯å£
  - ç±»å‹ï¼šæ•´æ•°
  - æè¿°ï¼šæœ‰ä¸€ä¸ªæ•´æ•°å€¼
- d
  - åŠŸèƒ½ï¼šç›®å½•
  - ç±»å‹ï¼šå­—ç¬¦ä¸²
  - æè¿°æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²
- g
  - åŠŸèƒ½ï¼šä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨
  - ç±»å‹ï¼šå­—ç¬¦ä¸²
- d
  - åŠŸèƒ½ï¼šè¡¨ç¤ºä¸€ä¸ªæ•´æ•°åˆ—è¡¨
  - ç±»å‹ï¼šæ•´æ•°ç»„æˆçš„å­—ç¬¦ä¸²
- å¦‚æœå‚æ•°ä¸­æ²¡æœ‰æŒ‡å®šæŸä¸ªæ ‡å¿—ï¼Œé‚£ä¹ˆè§£æå™¨åº”è¯¥æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼
  - å¸ƒå°”ï¼šfalse
  - æ•´æ•°ï¼š0
  - åˆ—è¡¨ï¼š[]
- å¦‚æœç»™å‡ºçš„å‚æ•°ä¸æ¨¡å¼ä¸åŒ¹é…ï¼Œç»™å‡ºå‹å¥½æç¤º
  - ç®€è¦é”™è¯¯ä¿¡æ¯
  - å‘ŠçŸ¥é”™è¯¯åŸå› 

## å®ç°æ€è·¯

### ä¸‰ç§å®ç°æ–¹å¼

1. -l -p 8080 -d /usr/logs ä¸€æ¬¡è§£ææ•´ä¸ªå­—ç¬¦ä¸²è§£æï¼ˆéš¾åº¦å¤§ï¼‰
2. [-l], [-p, 8080], [-d, /usr/logs] æŒ‰åŠŸèƒ½åˆ’åˆ†ï¼Œå¤„ç†ç‰¹å®šæ•°ç»„ï¼ˆç®€å•ï¼‰ğŸ’¡ è¯¾ç¨‹ä¸­é€‰å–äº†æœ€ç®€å•çš„æ–¹æ¡ˆå®ç°
3. {-l:[], -p:[8080], -d:[/usr/logs]} æŒ‰åŠŸèƒ½åˆ’åˆ†ï¼Œä»Mapä¸­å–å‡ºç›¸åº”çš„å€¼ï¼ˆæ¯”æ•°ç»„å¤æ‚ï¼‰

### æ–¹å¼ 2 çš„å®ç°

#### å•ä¸ªåŠŸèƒ½

- å¸ƒå°”ç±»å‹ï¼š-l
- å•æ•´æ•°ç±»å‹ï¼š-p 8080
- å•ä¸ªè¿ç»­å­—ç¬¦ä¸²ç±»å‹ï¼š-d /usr/logs

#### ç»„åˆåŠŸèƒ½

-l -p 8080 -d /usr/logs

#### å¼‚å¸¸æƒ…å†µ

- å¸ƒå°”ç±»å‹ï¼šè¾“å…¥ -l a; -l 3
- å•æ•´æ•°ç±»å‹ï¼šè¾“å…¥ -p a; -p 3.14
- å•ä¸ªè¿ç»­å­—ç¬¦ä¸²ç±»å‹ï¼šè¾“å…¥ -d a b c; -d /usr/logs /usr/logs/a.log

## æ„Ÿæ‚Ÿ

- ç«™åœ¨ä½¿ç”¨è€…çš„è§’åº¦çœ‹å¾…è‡ªå·±çš„ä»£ç 

## Java ç¬¬ä¸€ç‰ˆ

### å¼€å‘ç¯å¢ƒ

- JDK 17
- Gradle 7.3.3

Option.java

```java
package com.wyyl1.geektimetdd.args;

import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.PARAMETER)
public @interface Option {

    String value();
}
```

Args.java

```java
package com.wyyl1.geektimetdd.args;

import java.lang.reflect.Constructor;
import java.lang.reflect.Parameter;
import java.util.Arrays;
import java.util.List;

public class Args {

    public static <T> T parse(Class<T> optionsClass, String... args) {
        Constructor<?> constructor = optionsClass.getDeclaredConstructors()[0];
        try {
            List<String> arguments = Arrays.stream(args).toList();
            Object[] values = Arrays.stream(constructor.getParameters())
                    .map(it -> parseOption(arguments, it))
                    .toArray();

            return (T) constructor.newInstance(values);
        } catch (Exception e) {
            throw new RuntimeException();
        }
    }

    private static Object parseOption(List<String> arguments, Parameter parameter) {
        Option option = parameter.getAnnotation(Option.class);
        Object value = null;

        String flag = "-" + option.value();
        if (parameter.getType() == boolean.class) {
            value = arguments.contains(flag);
        }
        if (parameter.getType() == int.class) {
            int index = arguments.indexOf(flag);
            value = Integer.parseInt(arguments.get(index + 1));
        }
        if (parameter.getType() == String.class) {
            int index = arguments.indexOf(flag);
            value = arguments.get(index + 1);
        }
        return value;
    }
}
```

ArgsTest.java

```java
package com.wyyl1.geektimetdd.args;

import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.*;

class ArgsTest {

    @Test
    void should_set_boolean_option_to_return_true_if_flag_present(){
        BooleanOption option = Args.parse(BooleanOption.class, "-l");

        assertTrue(option.logging);
    }

    @Test
    void should_set_boolean_option_to_return_false_if_flag_not_present(){
        BooleanOption option = Args.parse(BooleanOption.class);

        assertFalse(option.logging);
    }

    record BooleanOption(@Option("l") boolean logging) {
    }

    @Test
    void should_parse_int_as_option_value() {
        IntOption option = Args.parse(IntOption.class, "-p", "8080");
        assertEquals(8080, option.port);
    }

    record IntOption(@Option("p") int port) {
    }

    @Test
    void should_parse_string_as_option_value() {
        StringOption option = Args.parse(StringOption.class, "-d", "/usr/logs");
        assertEquals("/usr/logs", option.directory);
    }

    record StringOption(@Option("d") String directory) {

    }

    @Test
    void should_parse_multi_options(){
        MultiOptions options = Args.parse(MultiOptions.class, "-l", "-p", "8080", "-d", "/usr/logs");
        assertTrue(options.logging);
        assertEquals(8080, options.port);
        assertEquals("/usr/logs", options.directory);
    }

    record MultiOptions(@Option("l") boolean logging, @Option("p") int port, @Option("d") String directory) {
    }
}
```
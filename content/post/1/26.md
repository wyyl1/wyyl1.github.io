---
title: "26 | 缓存异常（下）：如何解决缓存雪崩、击穿、穿透难题？"
date: 2021-04-06T10:30:05+08:00
draft: false
tags: ["Redis"]
categories: ["存储"]
---

[极客时间 | 《Redis核心技术与实战》学习笔记目录](../dir)

[原文](https://time.geekbang.org/column/article/296586)

## 缓存雪崩

> 缓存雪崩是指大量的应用请求无法在 Redis 缓存中进行处理，紧接着，应用将大量请求发送到数据库层，导致数据库层的压力激增。

### 缓存雪崩的主要两个原因

- 缓存中有大量数据同时过期，导致大量请求无法得到处理
  - 避免给大量的数据设置相同的过期时间
  - 通过服务降级，来应对缓存雪崩
    - 当业务应用访问的是非核心数据（例如电商商品属性）时，暂时停止从缓存中查询这些数据，而是直接返回预定义信息、空值或是错误信息
    - 当业务应用访问的是核心数据（例如电商商品库存）时，仍然允许查询缓存，如果缓存缺失，也可以继续通过数据库读取
- Redis 缓存实例发生故障宕机了，无法处理请求，这就会导致大量请求一下子积压到数据库层，从而发生缓存雪崩
  - 在业务系统中实现服务熔断或请求限流机制
  - 事前预防：通过主从节点的方式构建 Redis 缓存高可靠集群

## 缓存击穿

> 缓存击穿是指，针对某个访问非常频繁的热点数据的请求，无法在缓存中进行处理，紧接着，访问该数据的大量请求，一下子都发送到了后端数据库，导致了数据库压力激增，会影响数据库处理其他请求。缓存击穿的情况，经常发生在热点数据过期失效时

- 对于访问特别频繁的热点数据，不设置过期时间

## 缓存穿透

> 缓存穿透是指要访问的数据既不在 Redis 缓存中，也不在数据库中，导致请求在访问缓存时，发生缓存缺失，再去访问数据库时，发现数据库中也没有要访问的数据。

### 缓存穿透发生的两种情况：

- 业务层误操作：缓存中的数据和数据库中的数据被误删除了，所以缓存和数据库中都没有数据；
- 恶意攻击：专门访问数据库中没有的数据

### 避免缓存穿透的三种方案
  
- 缓存空值或缺省值
- 使用布隆过滤器快速判断数据是否存在，避免从数据库中查询数据是否存在，减轻数据库压力
- 在请求入口的前端进行请求检测
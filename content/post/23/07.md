---
title: "事件风暴"
date: 2023-07-18T00:20:01+08:00
draft: false
tags: ["DDD","极客时间"]
categories: ["学习笔记"]
---

> [DDD 学习笔记 | 极客时间 | 手把手教你落地 DDD](../dir)

[🏆 原文：03｜事件风暴（上）：怎样和业务愉快地聊需求？](http://gk.link/a/12738)

[🏆 原文：04｜事件风暴（下）：事件风暴还有哪些诀窍？](http://gk.link/a/127lQ)

## 目的

- 帮助理解需求
  - 系统有哪些功能
  - 这些功能由什么角色操作
  - 操作后会产生什么效果
- 帮助**识别领域对象**

## 开始前的准备

对**主业务流程**有自己的理解

## 事件风暴的主要过程

![](../../../../../post/23/事件风暴主要过程.svg)

## 事件风暴的第一步：识别领域事件

> - 所谓领域事件，就是在业务过程中，业务人员要关注的那些已经发生的事儿（比方说，对于电子商务系统，订单已提交、商品已签收等等，都是领域事件）。
> - 实际上，领域事件表示的是，**业务流程中每个步骤引发的结果**。
> - 事件风暴的作者认为，从结果入手来梳理需求，比从操作入手，更容易把业务想清楚。
> - 事件风暴中的“事件”两个字就来源于领域事件。

### 领域事件的命名

- 如果套用英语的语法来说，一般是完成时 + 被动语态。比如说，订单已提交，这个“已”字就是完成时，代表已经发生的事情。
- 如果业务上已经有约定俗成的术语，我们就直接使用术语，这样更容易和业务沟通。例如：「已立项」是通用术语

### 识别「项目管理」流程的领域事件

- 第一行表示主流程，包括必然发生的事件
- 第二行表示可选的事件（包括异常事件）

![](../../../../../post/23/项目管理流程的领域事件.svg)


### 所有流程的领域事件

![](../../../../../post/23/所有流程的领域事件.svg)

### 领域事件需要注意两点

- 第一、**不要把技术事件当成领域事件**
  - 领域事件一定要是领域专家所关注的，用的是**业务术语**
  - 像数据库事务已回滚、缓存已命中之类的技术术语，不是领域事件
- 第二、**查询功能不算领域事件**
  - 领域事件应该是对某样事物产生了影响，并被记录的事情
  - 一般是某个事物的创建、修改和删除
  - 还有一种情况是向其他人或者系统发消息，例如“通知邮件已发送”也算领域事件，因为接收方可能会通过进一步处理来影响某些事物
  - 这并不代表查询功能不重要，查询功能也要以某种方式体现

### 领域事件小结

- 在这个过程里，我们已经开始形成统一语言。所谓**统一语言**，英文是 **Ubiquitous Language**，是 DDD 中的一个核心模式。指的是业务人员和开发人员使用的语言要一致。语言是知识的载体。语言一致就意味着背后对领域知识的理解一致。统一语言贯穿了 DDD 的全过程。
- 我们也开始识别**业务规则**
- **「协作」才是事件风暴的精髓**，而具体结果怎样呈现，反而是第二位的

### 思考：当前识别的领域事件，主要是以「增加」的功能为主，你觉得需要把修改和删除的功能都列出来吗？

- 修改删除之类的，有相关的业务才需要列出来，比如合同签订了就只能违约，不能修改和删除，那就只有一个合同已违约，修改和删除甚至创建都一样是技术术语，事件风暴最好用业务术语
- 不需要列举修改和删除功能，避免冲淡了领域事件的聚焦。特别是对于修改和删除操作本身不复杂的领域事件，就更没有必要了；修改和删除所关联到的规则，可以在业务规则中说明
- 领域事件一定是**领域专家所关注的**，用的业务术语。如果修改会引起业务流程的变化，例如合同金额发生变化，那是需要单独列出来的。如果只是修改了某个备注字段，就不需要单独列出来

### 在做事件风暴的时候，如果事件本身很简单，但是业务规则非常复杂，这种情况怎么去揭示复杂的业务规则呢？

使用业务规则表

## 事件风暴第二步：识别命令

> - 所谓命令（command），就是**引发领域事件的操作**，我们可以通过分析领域事件得到
> - 除了识别出命令本身以外，我们通常还要识别出谁执行的命令，以及为了执行命令我们要查询出什么数据。

### 命令、执行者、查询数据简介

1. **蓝** **命令**：对于「合同已签订」这个事件，对应的命令就是「签订合同」
2. **粉** **执行者**：「签订合同」的执行者是「销售人员」
3. **绿** **查询数据**：在执行「签订合同」操作时，「执行者」先从系统中查出客户信息，才能和中国客户签订合同。「客户」是一种「查询数据」

![](../../../../../post/23/命令的所有信息.svg)

没有查询数据的命令

![](../../../../../post/23/没有查询数据的命令.svg)

有多个查询数据的命令

![](../../../../../post/23/有多个查询数据的命令.svg)

有多个执行者的命令

![](../../../../../post/23/有多个执行者的命令.svg)

## 事件风暴第三步：识别领域名词

> - 这里说的领域名词，是从**领域事件**、**命令**、**执行者**、**查询数据**里找到的名词性概念
> - 例如，对于签订合同这个命令而言，受到影响的名词性概念是「合同」
> - 类似地，对于合同已签订这个领域事件，是由于「合同」这个**名词**性概念的**状态变化**所导致的。

### 识别领域名词的方法：从**领域事件**、**命令**、**查询数据**中寻找

第一步：把围**绕同一个名词**（相同/相关名词）的「领域事件」放在一起，按「名词」分组

![](../../../../../post/23/识别领域名词-1.svg)

第二步：将「领域事件」对应的「命令」、「查询数据」加入分组

![](../../../../../post/23/识别领域名词-2.svg)

第三步：将「领域名词」加入分组

![](../../../../../post/23/识别领域名词-3.svg)

## 其他资源

- [draw.io 头脑风暴模版](https://drawio-app.com/blog/brainstorming-with-draw-io/#)
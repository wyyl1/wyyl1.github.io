---
title: "替换数据库解决 MySQL 超大表查询性能问题"
date: 2025-12-25T00:20:01+08:00
draft: false
tags: ["避坑"]
categories: ["零碎笔记"]
---

## 背景

MySQL 5.7 单表数据量 2000 万+，伴随业务增长，预估每月增加 100 万数据，查询性能逐渐下降。

已无法通过 MySQL 配置参数调优，升级硬件解决问题。

## 期望

在**不改/少量**改动已有代码的前提下，提升查询性能

## 向 AI 提问

MySQL 数据量太大，可以把数据转移到其他性能更好的数据库，且支持 MySQL 的所有查询语句吗

## AI 解决方案

### 1. TiDB（目前最流行的高兼容方案）

TiDB 是目前国内和国际上解决 MySQL 大数据量问题的首选方案。

性能表现： 采用分布式架构。当你数据量大到单机扛不住时，只需增加服务器节点，性能和存储空间就会线性增长。

MySQL 兼容性： 极高。 它直接使用了 MySQL 的网络协议。你的 Java/Python 代码、MyBatis 框架、甚至是数据库连接工具（如 Navicat），都可以直接连接 TiDB。

查询支持： 支持绝大多数 MySQL 5.7 和 8.0 的语法，包括复杂的 Join、子查询和索引。

亮点： 它不仅能跑业务（OLTP），还内置了列式存储引擎，跑复杂的分析报表（OLAP）也非常快。

### 2. OceanBase（蚂蚁集团自研，极致性能）

OceanBase 经历了“双十一”这种极端场景的考验，性能极其强悍。

性能表现： 能够支撑 PB 级别的数据，且在数据压缩方面做得非常好（同样的数据，在 OceanBase 里可能只占 MySQL 1/3 的空间）。

MySQL 兼容性： 它的 MySQL 模式兼容性非常深，不仅是语法，连很多底层行为和报错信息都力求和 MySQL 一致。

查询支持： 完整支持事务（ACID）和标准的 MySQL SQL 语句。

### 3. MariaDB（10.x+）

MySQL 原作者开发，兼容 MySQL 5.7/8.0，新增列存引擎（ColumnStore）适配分析型查询

### 4. StarRocks（4.0+）

主打 OLAP「联机分析处理」，兼容 MySQL 查询语法，支持 MPP 分布式查询，分析性能比 MySQL 高 10-100 倍

## 迁移关键注意事项

### 兼容性验证

工具：用 Percona Toolkit、TiDB SQL Checker、OceanBase 迁移评估工具扫描 SQL，自动识别不兼容语句；

### 重点检查

MySQL 专属函数（如GET_LOCK）、存储过程 / 触发器、分区表语法、/*+ HINT */优化器提示。

性能验证即使语法兼容，不同数据库的优化器逻辑不同，需对核心查询（如报表、复杂 JOIN）做执行计划分析和压测，避免 “语法兼容但性能下降”。
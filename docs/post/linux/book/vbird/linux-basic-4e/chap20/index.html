<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>第二十章、基础系统设置与备份策略 - </title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="aoe" />

<script src="/js/baidu_tongji.js"></script><meta name="description" content="原书：《鸟哥的Linux私房菜-基础篇》第四版 | 作者： 鳥哥 20.1 系统基本设置 网络基础-鸟哥 手动设置固定 IP 自动取得 IP 参数 修改主机名称 1 2 3 4 5 6 7" /><meta name="keywords" content="wyyl1, Hugo" />






<meta name="generator" content="Hugo 0.81.0 with theme even" />


<link rel="canonical" href="https://wyyl1.github.io/post/linux/book/vbird/linux-basic-4e/chap20/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.af7fd1da18d66c2b017df5b4cae508ef44cfcac3fb4c7c7a327fe4f4f9e28b08.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="第二十章、基础系统设置与备份策略" />
<meta property="og:description" content="原书：《鸟哥的Linux私房菜-基础篇》第四版 | 作者： 鳥哥 20.1 系统基本设置 网络基础-鸟哥 手动设置固定 IP 自动取得 IP 参数 修改主机名称 1 2 3 4 5 6 7" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wyyl1.github.io/post/linux/book/vbird/linux-basic-4e/chap20/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-04-20T10:20:00&#43;08:20" />
<meta property="article:modified_time" content="2021-04-20T10:20:00&#43;08:20" />

<meta itemprop="name" content="第二十章、基础系统设置与备份策略">
<meta itemprop="description" content="原书：《鸟哥的Linux私房菜-基础篇》第四版 | 作者： 鳥哥 20.1 系统基本设置 网络基础-鸟哥 手动设置固定 IP 自动取得 IP 参数 修改主机名称 1 2 3 4 5 6 7"><meta itemprop="datePublished" content="2021-04-20T10:20:00&#43;08:20" />
<meta itemprop="dateModified" content="2021-04-20T10:20:00&#43;08:20" />
<meta itemprop="wordCount" content="2707">
<meta itemprop="keywords" content="Linux,计算机概论,鸟哥的Linux私房菜-基础篇," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="第二十章、基础系统设置与备份策略"/>
<meta name="twitter:description" content="原书：《鸟哥的Linux私房菜-基础篇》第四版 | 作者： 鳥哥 20.1 系统基本设置 网络基础-鸟哥 手动设置固定 IP 自动取得 IP 参数 修改主机名称 1 2 3 4 5 6 7"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">wyyl1</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/post/dir">
        <li class="mobile-menu-item">目录</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">wyyl1</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/dir">目录</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">第二十章、基础系统设置与备份策略</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-04-20 </span>
        <div class="post-category">
            <a href="/categories/linux/"> Linux </a>
            <a href="/categories/%E9%B8%9F%E5%93%A5%E7%9A%84linux%E7%A7%81%E6%88%BF%E8%8F%9C-%E5%9F%BA%E7%A1%80%E7%AF%87/"> 鸟哥的Linux私房菜-基础篇 </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#201-系统基本设置">20.1 系统基本设置</a>
          <ul>
            <li><a href="#手动设置固定-ip">手动设置固定 IP</a></li>
            <li><a href="#自动取得-ip-参数">自动取得 IP 参数</a></li>
            <li><a href="#修改主机名称">修改主机名称</a></li>
          </ul>
        </li>
        <li><a href="#2012-日期与时间设置">20.1.2 日期与时间设置</a>
          <ul>
            <li><a href="#时区的显示与设置">时区的显示与设置</a></li>
            <li><a href="#时间的调整">时间的调整</a></li>
            <li><a href="#用-ntpdate-手动网络校时">用 ntpdate 手动网络校时</a></li>
          </ul>
        </li>
        <li><a href="#2013-语系设置">20.1.3 语系设置</a></li>
        <li><a href="#2014-防火墙简易设置">20.1.4 防火墙简易设置</a></li>
        <li><a href="#202-服务器硬件数据的收集">20.2 服务器硬件数据的收集</a></li>
        <li><a href="#2021-以系统内置-dmidecode-解析硬件配备">20.2.1 以系统内置 dmidecode 解析硬件配备</a></li>
        <li><a href="#2022-硬件资源的收集与分析">20.2.2 硬件资源的收集与分析</a>
          <ul>
            <li><a href="#iostat">iostat</a></li>
          </ul>
        </li>
        <li><a href="#2023-了解磁盘的健康状态">20.2.3 了解磁盘的健康状态</a></li>
        <li><a href="#203-备份要点">20.3 备份要点</a></li>
        <li><a href="#2031-备份数据的考虑">20.3.1 备份数据的考虑</a></li>
        <li><a href="#2032-哪些-linux-数据具有备份的意义">20.3.2 哪些 Linux 数据具有备份的意义</a>
          <ul>
            <li><a href="#有必要备份的文件">有必要备份的文件</a></li>
            <li><a href="#不需要备份的目录">不需要备份的目录</a></li>
          </ul>
        </li>
        <li><a href="#2033-备份用储存媒体的选择">20.3.3 备份用储存媒体的选择</a></li>
        <li><a href="#204-备份的种类频率与工具的选择">20.4 备份的种类、频率与工具的选择</a></li>
        <li><a href="#2041-完整备份之累积备份-incremental-backup">20.4.1 完整备份之累积备份 (Incremental backup)</a>
          <ul>
            <li><a href="#累积备份的原则">累积备份的原则</a></li>
            <li><a href="#累积备份使用的备份软件">累积备份使用的备份软件</a></li>
          </ul>
        </li>
        <li><a href="#2042-完整备份之差异备份-differential-backup">20.4.2 完整备份之差异备份 (Differential backup)</a></li>
        <li><a href="#2043-关键数据备份">20.4.3 关键数据备份</a></li>
        <li><a href="#205-鸟哥的备份策略">20.5 鸟哥的备份策略</a></li>
        <li><a href="#2051-每周系统备份的-script">20.5.1 每周系统备份的 script</a>
          <ul>
            <li><a href="#启用定时任务">启用定时任务</a></li>
          </ul>
        </li>
        <li><a href="#2053-远端备援的-script">20.5.3 远端备援的 script</a></li>
        <li><a href="#206-灾难复原的考虑">20.6 灾难复原的考虑</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <blockquote>
<p>原书：《鸟哥的Linux私房菜-基础篇》第四版 | 作者：
<a href="http://linux.vbird.org/"  target="_blank"  rel="noopener">鳥哥</a></p>
</blockquote>
<h2 id="201-系统基本设置">20.1 系统基本设置</h2>
<ul>
<li>
<a href="http://linux.vbird.org/linux_server/0110network_basic.php"  target="_blank"  rel="noopener">网络基础-鸟哥</a></li>
</ul>
<h3 id="手动设置固定-ip">手动设置固定 IP</h3>
<h3 id="自动取得-ip-参数">自动取得 IP 参数</h3>
<h3 id="修改主机名称">修改主机名称</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd"># 显示目前的主机名称与相关信息
hostnamectl

# hostnamectl [set-hostname 你的主机名]
# 尝试修改主机名称为 www.centos.vbird
hostnamectl set-hostname www.centos.vbird
cat /etc/hostname
</code></pre></td></tr></table>
</div>
</div><h2 id="2012-日期与时间设置">20.1.2 日期与时间设置</h2>
<h3 id="时区的显示与设置">时区的显示与设置</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd">timedatectl [commamd]
</code></pre></td></tr></table>
</div>
</div><p>选项与参数:</p>
<ul>
<li>list-timezones :列出系统上所有支持的时区名称</li>
<li>set-timezone :设置时区位置</li>
<li>set-time :设置时间</li>
<li>set-ntp :设置网络校时系统</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd"># 1. 显示目前的时区与时间等信息
timedatectl
Local time: Tue 2015-09-01 19:50:09 CST # 本地时间
 Universal time: Tue 2015-09-01 11:50:09 UTC # UTC 时间，可称为格林威治标准时间
  RTC time: Tue 2015-09-01 11:50:12
Timezone: Asia/Taipei (CST, +0800) # 就是时区啰!
  NTP enabled: no
 NTP synchronized: no
 RTC in local TZ: no
 DST active: n/a

# 2. 查看是否有 Shanghai 的时区
timedatectl list-timezones <span class="p">|</span>grep Shanghai

# 3. 设置时区
timedatectl set-timezone <span class="s2">&#34;Asia/Shanghai&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="时间的调整">时间的调整</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd">timedatectl set-time <span class="s2">&#34;2015-09-01 12:02&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="用-ntpdate-手动网络校时">用 ntpdate 手动网络校时</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd">ntpdate tock.stdtime.gov.tw

hwclock -w
</code></pre></td></tr></table>
</div>
</div><h2 id="2013-语系设置">20.1.3 语系设置</h2>
<p>查看</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd">localectl
</code></pre></td></tr></table>
</div>
</div><h2 id="2014-防火墙简易设置">20.1.4 防火墙简易设置</h2>
<h2 id="202-服务器硬件数据的收集">20.2 服务器硬件数据的收集</h2>
<h2 id="2021-以系统内置-dmidecode-解析硬件配备">20.2.1 以系统内置 dmidecode 解析硬件配备</h2>
<p>秀出整个系统的硬件信息，例如主板型号等等</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd">dmidecode -t 1
</code></pre></td></tr></table>
</div>
</div><p>内存相关的数据呢?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd">dmidecode -t 17
</code></pre></td></tr></table>
</div>
</div><h2 id="2022-硬件资源的收集与分析">20.2.2 硬件资源的收集与分析</h2>
<ul>
<li>gdisk:第七章曾经谈过，可以使用 gdisk -l 将分区表列出;</li>
<li>dmesg:第十六章谈过， 观察核心运行过程当中所显示的各项讯息记录;</li>
<li>vmstat:第十六章谈过，可分析系统 (CPU/RAM/IO) 目前的状态;</li>
<li>lspci:列出整个 PC 系统的 PCI 接口设备!很有用的指令;</li>
<li>lsusb:列出目前系统上面各个 USB 端口的状态，与连接的 USB 设备;</li>
<li>iostat:与 vmstat 类似，可实时列出整个 CPU 与周边设备的 Input/Output 状态。</li>
</ul>
<h3 id="iostat">iostat</h3>
<p>磁盘由开机到现在，已经存取多少数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd">选项与参数:
 -c :仅显示 CPU 的状态;
 -d :仅显示储存设备的状态，不可与 -c 一起用;
 -k :默认显示的是 block ，这里可以改成 K Bytes 的大小来显示;
 -m :与 -k 类似，只是以 MB 的单位来显示结果。
 -t :显示日期出来;
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd"># 显示一下目前整个系统的 CPU 与储存设备的状态
iostat

# 上面数据总共分为上下两部分，上半部显示的是 CPU 的当下信息;
# 下面数据则是显示储存设备包括 /dev/vda 的相关数据，他的数据意义:
# tps :平均每秒钟的传送次数!与数据传输“次数”有关，非容量!
# kB_read/s :开机到现在平均的读取单位;
# kB_wrtn/s :开机到现在平均的写入单位;
# kB_read :开机到现在，总共读出来的文件单位;
# kB_wrtn :开机到现在，总共写入的文件单位;

# 仅针对 vda ，每两秒钟侦测一次，并且共侦测三次储存设备
iostat -d 2 3 vda

# 仔细看一下，如果是有侦测次数的情况，那么第一次显示的是“从开机到现在的数据”，
# 第二次以后所显示的数据则代表两次侦测之间的系统传输值!举例来说，上面的信息中，
# 第二次显示的数据，则是两秒钟内(本案例)系统的总传输量与平均值
</code></pre></td></tr></table>
</div>
</div><h2 id="2023-了解磁盘的健康状态">20.2.3 了解磁盘的健康状态</h2>
<p>smartd 服务：怎么知道你的磁盘是好是坏啊?</p>
<p>SMART 其实是“ Self-Monitoring, Analysis and Reporting Technology System ”的缩写，主要 用来监测目前常见的 ATA 与 SCSI 界面的磁盘， 只是，要被监测的磁盘也必须要支持 SMART 的协定才行!否则 smartd 就无法去下达指令</p>
<blockquote>
<p>⚠️ 特别强调的是，因为进行磁盘自我检查时，可能磁盘的 I/O 状态会比较频繁，因此不建 议在系统忙碌的时候进行喔! 否则系统的性能是可能会被影响的哩!要注意!要注意!</p>
</blockquote>
<h2 id="203-备份要点">20.3 备份要点</h2>
<h2 id="2031-备份数据的考虑">20.3.1 备份数据的考虑</h2>
<p>造成系统损毁的问题</p>
<ul>
<li>硬件问题</li>
<li>软件与人的问题</li>
<li>主机角色不同，备份任务也不同</li>
</ul>
<h2 id="2032-哪些-linux-数据具有备份的意义">20.3.2 哪些 Linux 数据具有备份的意义</h2>
<h3 id="有必要备份的文件">有必要备份的文件</h3>
<ul>
<li>一类是系统基本设置信息</li>
<li>一类则是类似网络服务的内容数据</li>
</ul>
<h4 id="操作系统本身需要备份的文件">操作系统本身需要备份的文件</h4>
<p>主要跟“帐号与系统配置文件”有关系</p>
<ul>
<li>/etc/passwd, /etc/shadow, /etc/group, /etc/gshadow, /home</li>
<li>由于 Linux 默认的重要参数文件都在 /etc/ 下面，所以只要将这个目录备份下来的话， 那么 几乎所有的配置文件都可以被保存的!</li>
<li>/home 目录是一般用户的主文件夹，自然也需要来备份一番!</li>
<li>由于使用者会有邮 件吧!所以呢，这个 /var/spool/mail/ 内容也需要备份呦!</li>
<li>如果你曾经自行更动过 核心，那么 /boot 里头的信息也就很重要啰!</li>
</ul>
<p><strong>必须要备份的文件为</strong></p>
<ul>
<li>/etc/ 整个目录</li>
<li>/home/ 整个目录</li>
<li>/var/spool/mail/</li>
<li>/var/spoll/{at|cron}/</li>
<li>/boot/</li>
<li>/root/</li>
<li>如果你自行安装过其他的软件，那么 /usr/local/ 或 /opt 也最好备份一下!</li>
</ul>
<h4 id="网络服务的数据库方面">网络服务的数据库方面</h4>
<ul>
<li>/var/spool/mail/, /var/spool/cron/, /var/spool/at/</li>
<li>/var/lib/</li>
</ul>
<h3 id="不需要备份的目录">不需要备份的目录</h3>
<ul>
<li>/dev :这个随便你要不要备份</li>
<li>/proc, /sys, /run:这个真的不需要备份啦!</li>
<li>/mnt, /media:如果你没有在这个目录内放置你自己系统的东西，也不需要备份</li>
<li>/tmp :干嘛存暂存盘!不需要备份!</li>
</ul>
<h2 id="2033-备份用储存媒体的选择">20.3.3 备份用储存媒体的选择</h2>
<ul>
<li>异地备援系统</li>
<li>储存媒体的考虑
<ul>
<li>NAS 储存设备</li>
</ul>
</li>
</ul>
<h2 id="204-备份的种类频率与工具的选择">20.4 备份的种类、频率与工具的选择</h2>
<h2 id="2041-完整备份之累积备份-incremental-backup">20.4.1 完整备份之累积备份 (Incremental backup)</h2>
<h3 id="累积备份的原则">累积备份的原则</h3>
<blockquote>
<p>累积备份，指的是在系统在进行完第一次完整备份后，经过一段时间的运行， 比较系 统与备份文件之间的差异，仅备份有差异的文件而已。而第二次累积备份则与第一次累积备 份的数据比较， 也是仅备份有差异的数据而已。如此一来，由于仅备份有差异的数据，因此 备份的数据量小且快速!备份也很有效率。</p>
</blockquote>
<h3 id="累积备份使用的备份软件">累积备份使用的备份软件</h3>
<p>完整备份常用的工具有 dd, cpio, xfsdump/xfsrestore 等等</p>
<ul>
<li>dd 可以直接读取磁盘的扇区 (sector) 而不理会文件系统，是相当良好的备份 工具!不过缺点就是慢很多!</li>
<li>cpio 是能够备份所有文件名，不过，得要配合 find 或其他找文 件名的指令才能够处理妥当。</li>
<li>可以直接进行累积备份的就是 xfsdump 这个指令，详细的指令与参数用法，请前往<strong>第八章</strong>查阅</li>
</ul>
<p>命令举例详见原文</p>
<h2 id="2042-完整备份之差异备份-differential-backup">20.4.2 完整备份之差异备份 (Differential backup)</h2>
<blockquote>
<p>差异备份与累积备份有点类似，也是需要进行第一次的完整备份后才能够进行。只是差异备 份指的是:每次的备份都是与原始的完整备份比较的结果。所以系统运行的越久，离完整备 份时间越长， 那么该次的差异备份数据可能就会越大!</p>
</blockquote>
<h2 id="2043-关键数据备份">20.4.3 关键数据备份</h2>
<p>备份关键数据鸟哥最爱使用 tar 来处理了!如果想要分门别类的将各种不同的服务在不同的时 间备份使用不同文件名， 配合 date 指令是非常好用的工具!例如下面的案例是依据日期来备 份 mariadb 的数据库喔!</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd">tar -jpcvf mysql.`date +<span class="nv">%Y-%</span>m-%d`.tar.bz2 /var/lib/mysql
</code></pre></td></tr></table>
</div>
</div><p>备份是非常重要的工作，你可不希望想到才进行吧?交给系统自动处理就对啦!请自己撰写 script ， 配合 crontab 去执行吧!这样子，备份会很轻松喔!</p>
<h2 id="205-鸟哥的备份策略">20.5 鸟哥的备份策略</h2>
<h2 id="2051-每周系统备份的-script">20.5.1 每周系统备份的 script</h2>
<p>
<a href="http://linux.vbird.org/linux_basic/0580backup/backupwk-0.1.sh"  target="_blank"  rel="noopener">backupwk-0.1.sh 脚本下载</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="cp">#!/bin/bash
</span><span class="cp"></span><span class="c1"># ====================================================================</span>
<span class="c1"># 使用者參數輸入位置：</span>
<span class="c1"># basedir=你用來儲存此腳本所預計備份的資料之目錄(請獨立檔案系統)</span>
<span class="nv">basedir</span><span class="o">=</span>/backup/weekly

<span class="c1"># ====================================================================</span>
<span class="c1"># 底下請不要修改了！用預設值即可！</span>
<span class="nv">PATH</span><span class="o">=</span>/bin:/usr/bin:/sbin:/usr/sbin<span class="p">;</span> <span class="nb">export</span> PATH
<span class="nb">export</span> <span class="nv">LANG</span><span class="o">=</span>C

<span class="c1"># 設定要備份的服務的設定檔，以及備份的目錄</span>
<span class="nv">named</span><span class="o">=</span><span class="nv">$basedir</span>/named
<span class="nv">postfixd</span><span class="o">=</span><span class="nv">$basedir</span>/postfix
<span class="nv">vsftpd</span><span class="o">=</span><span class="nv">$basedir</span>/vsftp
<span class="nv">sshd</span><span class="o">=</span><span class="nv">$basedir</span>/ssh
<span class="nv">sambad</span><span class="o">=</span><span class="nv">$basedir</span>/samba
<span class="nv">wwwd</span><span class="o">=</span><span class="nv">$basedir</span>/www
<span class="nv">others</span><span class="o">=</span><span class="nv">$basedir</span>/others
<span class="nv">userinfod</span><span class="o">=</span><span class="nv">$basedir</span>/userinfo
<span class="c1"># 判斷目錄是否存在，若不存在則予以建立。</span>
<span class="k">for</span> <span class="nb">dirs</span> in <span class="nv">$named</span> <span class="nv">$postfixd</span> <span class="nv">$vsftpd</span> <span class="nv">$sshd</span> <span class="nv">$sambad</span> <span class="nv">$wwwd</span> <span class="nv">$others</span> <span class="nv">$userinfod</span>
<span class="k">do</span>
	<span class="o">[</span> ! -d <span class="s2">&#34;</span><span class="nv">$dirs</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> mkdir -p <span class="nv">$dirs</span>
<span class="k">done</span>

<span class="c1"># 1. 將系統主要的服務之設定檔分別備份下來，同時也備份 /etc 全部。</span>
cp -a /var/named/chroot/<span class="o">{</span>etc,var<span class="o">}</span>	<span class="nv">$named</span>
cp -a /etc/postfix /etc/dovecot.conf	<span class="nv">$postfixd</span>
cp -a /etc/vsftpd/*			<span class="nv">$vsftpd</span>
cp -a /etc/ssh/*			<span class="nv">$sshd</span>
cp -a /etc/samba/*			<span class="nv">$sambad</span>
cp -a /etc/<span class="o">{</span>my.cnf,php.ini,httpd<span class="o">}</span>	<span class="nv">$wwwd</span>
<span class="nb">cd</span> /var/lib
  tar -jpc -f <span class="nv">$wwwd</span>/mysql.tar.bz2 	mysql
<span class="nb">cd</span> /var/www
  tar -jpc -f <span class="nv">$wwwd</span>/html.tar.bz2 	html cgi-bin
<span class="nb">cd</span> /
  tar -jpc -f <span class="nv">$others</span>/etc.tar.bz2	etc
<span class="nb">cd</span> /usr/
  tar -jpc -f <span class="nv">$others</span>/local.tar.bz2	<span class="nb">local</span>

<span class="c1"># 2. 關於使用者參數方面</span>
cp -a /etc/<span class="o">{</span>passwd,shadow,group<span class="o">}</span>	<span class="nv">$userinfod</span>
<span class="nb">cd</span> /var/spool
  tar -jpc -f <span class="nv">$userinfod</span>/mail.tar.bz2	mail
<span class="nb">cd</span> /
  tar -jpc -f <span class="nv">$userinfod</span>/home.tar.bz2	home
<span class="nb">cd</span> /var/spool
  tar -jpc -f <span class="nv">$userinfod</span>/cron.tar.bz2	cron at
</code></pre></td></tr></table>
</div>
</div><h3 id="启用定时任务">启用定时任务</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd">vi /etc/crontab

# 加入这两行即可 (请注意你的文件目录!不要照抄呦!)
30 3 * * 0 root /backup/backupwk.sh
30 2 * * * root /backup/backupday.sh
</code></pre></td></tr></table>
</div>
</div><h2 id="2053-远端备援的-script">20.5.3 远端备援的 script</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd">vi /backup/rsync.sh

#!/bin/bash
remotedir=/home/backup/
basedir=/backup/weekly
host=127.0.0.1
id=dmtsai

# 下面为程序阶段!不需要修改喔!
rsync -av -e ssh $basedir ${id}@${host}:${remotedir}
</code></pre></td></tr></table>
</div>
</div><h2 id="206-灾难复原的考虑">20.6 灾难复原的考虑</h2>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">aoe</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2021-04-20
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/linux/">Linux</a>
          <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%A6%82%E8%AE%BA/">计算机概论</a>
          <a href="/tags/%E9%B8%9F%E5%93%A5%E7%9A%84linux%E7%A7%81%E6%88%BF%E8%8F%9C-%E5%9F%BA%E7%A1%80%E7%AF%87/">鸟哥的Linux私房菜-基础篇</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/linux/book/vbird/linux-basic-4e/chap10/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">第十章、认识与学习BASH</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/storage/redis/geekbang/extra_meal06/">
            <span class="next-text nav-default">加餐（六）| Redis的使用规范小建议</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
      <a href="http://localhost:1313" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="http://localhost:1313" class="iconfont icon-twitter" title="twitter"></a>
      <a href="http://localhost:1313" class="iconfont icon-facebook" title="facebook"></a>
      <a href="http://localhost:1313" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="http://localhost:1313" class="iconfont icon-google" title="google"></a>
      <a href="http://localhost:1313" class="iconfont icon-github" title="github"></a>
      <a href="http://localhost:1313" class="iconfont icon-weibo" title="weibo"></a>
      <a href="http://localhost:1313" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="http://localhost:1313" class="iconfont icon-douban" title="douban"></a>
      <a href="http://localhost:1313" class="iconfont icon-pocket" title="pocket"></a>
      <a href="http://localhost:1313" class="iconfont icon-tumblr" title="tumblr"></a>
      <a href="http://localhost:1313" class="iconfont icon-instagram" title="instagram"></a>
      <a href="http://localhost:1313" class="iconfont icon-gitlab" title="gitlab"></a>
      <a href="http://localhost:1313" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="https://wyyl1.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    <a class="hexo-link" href="https://beian.miit.gov.cn">浙ICP备16025224号-1</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>aoe</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>






<script src="/js/baidu_tongji.js"></script>


</body>
</html>
